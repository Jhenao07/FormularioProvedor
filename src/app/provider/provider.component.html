<div class="provider-page">
  <div class="provider-wrapper">

    <header class="provider-header">
      <img src="assets/nuvant.png" alt="Nuvant" />
    </header>

    <nav class="steps">
      <div class="step" [class.active]="currentStep === 1">Documentos</div>
      <div class="step" [class.active]="currentStep === 2">Datos del proveedor</div>
      <div class="step" [class.active]="currentStep === 3">Revisi√≥n</div>
    </nav>

    <section class="provider-card" [formGroup]="form">
      <div class="step-container">

      <div *ngIf="currentStep === 1" formGroupName="step1" class="step-content">

        @if (!countrySelected) {
          <div class="empty-state">
            <div class="icon-info">üåç</div>
            <h2>Selecciona tu ubicaci√≥n</h2>
            <p>Para mostrarte los documentos requeridos, por favor selecciona el pa√≠s donde resides en el formulario anterior.</p>
          </div>
        }

        @else {
          <h2>Documentos requeridos para {{ countrySelected }}</h2>

          <div class="option-list">
            @for(doc of arrayItems(); track doc.key) {
              <div class="doc-item">
                <div class="option-text">
                  <strong>{{ doc.title }}</strong>
                  <p>Formato PDF, JPG o PNG</p>
                </div>

                <div class="doc-actions">
                  <input type="file" [id]="doc.key" hidden #fileInput (change)="onFileSelected($event, doc.key)" />

                  @if (!form.get('step1.' + doc.key)?.value) {
                    <button type="button" class="btn-outline" (click)="fileInput.click()">
                      Adjuntar
                    </button>
                  } @else {
                    <button type="button" class="btn-ai" (click)="procesarPdf(doc.key)">
                      ‚ú® Procesar
                    </button>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>

        <div *ngIf="currentStep === 2" formGroupName="step2" class="step-content">
          <div class="card">
            <h2 class="title">Identificaci√≥n del proveedor</h2>

            <div class="tabs">
              <button type="button" class="tab" [class.active]="providerType === 'juridica'" (click)="providerType='juridica'">
                Persona Jur√≠dica
              </button>
              <button type="button" class="tab" [class.active]="providerType === 'natural'" (click)="providerType='natural'">
                Persona Natural
              </button>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="label">Raz√≥n Social <span class="req">*</span></label>
                <div class="input-with-badge">
                  <input type="text" formControlName="businessName" placeholder="Nombre completo" />
                  <span class="badge" *ngIf="form.get('step2.businessName')?.value">Autocompletado</span>
                </div>
              </div>

              <div class="form-group">
                <label class="label">NIT / Documento <span class="req">*</span></label>
                <div class="input-with-badge">
                  <input type="text" formControlName="nit" placeholder="Escribe el NIT" />
                  <span class="badge" *ngIf="form.get('step2.nit')?.value">Autocompletado</span>
                </div>
              </div>

              <div class="form-group">
                <label class="label">Representante Legal <span class="req">*</span></label>
                <div class="input-with-badge">
                  <input type="text" formControlName="legalRepName" placeholder="Nombre completo" />
                  <span class="badge" *ngIf="form.get('step2.legalRepName')?.value">Autocompletado</span>
                </div>
              </div>

              <div class="form-group full">
                <label class="label">¬øCuenta con sistema de gesti√≥n de riesgo?</label>
                <div class="radio-row">
                  <label class="radio">
                    <input type="radio" formControlName="riskOption" value="SI" /> <span>S√≠</span>
                  </label>
                  <label class="radio">
                    <input type="radio" formControlName="riskOption" value="NO" /> <span>No</span>
                  </label>
                </div>
              </div>

              <div class="form-group" *ngIf="form.get('step2.riskOption')?.value === 'SI'">
                <label class="label">¬øCu√°l?</label>
                <input type="text" formControlName="riskWhich" placeholder="Ej: SAGRILAFT" />
              </div>
            </div>

            <div class="actions">
              <button type="button" class="btn-secondary" (click)="prevStep()">Atr√°s</button>
              <button type="button" class="btn-primary" (click)="nextStep()" [disabled]="form.get('step2')?.invalid">
                Siguiente
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="currentStep === 3" class="step-content">
          <h2>Revisi√≥n y env√≠o</h2>
          <div class="review-card">
            <ul class="review-list">
              <li>‚úî Documentos listos</li>
              <li>‚úî Datos extra√≠dos y validados</li>
            </ul>
          </div>
          <div class="actions">
            <button class="btn-secondary" (click)="prevStep()">Atr√°s</button>
            <button class="btn-primary" (click)="submitForm()">Enviar registro</button>
          </div>
        </div>

      </div>
    </section>
  </div>
</div>

<app-progress-overlay
  [open]="overlayOpen"
  [title]="overlayTitle"
  [subtitle]="overlaySubtitle"
  [indeterminate]="overlayIndeterminate"
  [current]="overlayCurrent"
  [total]="overlayTotal"
  [closable]="overlayClosable"
  (close)="onOverlayClose()">
</app-progress-overlay>
